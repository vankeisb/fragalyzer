(this.webpackJsonpfragalyzer=this.webpackJsonpfragalyzer||[]).push([[0],{31:function(e,t,n){"use strict";(function(e){n.d(t,"e",(function(){return c})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return u}));var r=n(37),a=n(645);function c(t){return new Promise((function(n,c){t.arrayBuffer().then((function(t){var o,i=e.from(t),s=new a.DemoFile,u=0,l=(new Date).getTime(),d=new Map,f=!1;s.on("tickend",(function(e){if(u++,f){var t=s.entities.players;t&&t.length>0&&t.forEach((function(t){if(t&&!t.isFakePlayer&&t.isAlive){var n=Object(r.pos)(t.position.x,t.position.y),a=d.get(t.name);void 0===a&&(a=[],d.set(t.name,a));var c={p:n,tick:e};a.push(c)}}))}}));var m=[],v=0;s.gameEvents.on("begin_new_match",(function(e){if(console.log("begin match"),void 0===o){f=!0,o=[];var t=s.players;o=t.filter((function(e){return!e.isFakePlayer&&e.teamNumber>=2})).map((function(e){var t=e.team;return{name:e.name,clanName:(null===t||void 0===t?void 0:t.clanName)||e.teamNumber.toString()}})),console.log("players",o)}}));var g=0;s.gameEvents.on("round_start",(function(){console.log("round start"),g=s.currentTick})),s.gameEvents.on("round_end",(function(e){console.log("round end",e.winner),v=e.winner})),s.gameEvents.on("round_officially_ended",(function(e){console.log("round officially ended");var t=s.teams,n=t[2],r=t[3];console.log("\t%s: %s score %d\n\t%s: %s score %d",n.teamName,n.clanName,n.score,r.teamName,r.clanName,r.score),m.push({startTick:g,endTick:s.currentTick,winner:v,scoreCT:r.score,clanCT:r.clanName,scoreT:n.score,clanT:n.clanName})})),s.gameEvents.on("round_start",(function(e){v=0,console.log("round start",s.gameRules.roundsPlayed)})),s.on("end",(function(e){if(console.log("done, ticks =",u,"elapsed =",(new Date).getTime()-l),console.log("Finished."),e.error)console.error("Error during parsing:",e.error),c(e);else{var t={positions:d,players:o,rounds:m,tickRate:s.tickRate};console.log("parsed",t),n(t)}})),s.parse(i)}))}))}function o(e,t,n){var r=new Map;return e.forEach((function(e,a){t.has(a)&&r.set(a,e.filter((function(e){return void 0!==n.find((function(t){return e.tick>=t[0]&&e.tick<=t[1]}))})))})),r}function i(e){var t=new Set;return e.players.forEach((function(e){t.add(e.clanName)})),Array.from(t).sort()}function s(e,t){var n=new Array;return e.players.forEach((function(e){e.clanName===t&&n.push(e)})),n.sort((function(e,t){return e.name.localeCompare(t.name)}))}function u(e){return e.players.map((function(e){return e.name})).sort()}}).call(this,n(71).Buffer)},650:function(e,t,n){},651:function(e,t,n){},764:function(e,t,n){"use strict";n.r(t);var r=n(65),a=n.n(r),c=n(644),o=n.n(c),i=(n(650),n(132)),s=n(11),u=(n(651),n(10)),l=n(94),d=n(37),f=n(133),m=n(51),v=n(31);function g(e,t,n,r){return(n+-e)/((t-e)/r)}var j=[[0,140,255],[255,140,255],[255,0,255],[255,0,0],[255,132,97],[0,183,32],[238,183,32],[10,183,164],[198,197,0],[42,197,255],[221,91,90]],p=[0,0,0];function h(e,t){var n=e.indexOf(t);if(-1===n)return p;var r=j[n];return null!==r&&void 0!==r?r:p}function b(e,t){return"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(t,")")}var O={64:.2,128:.1};function y(e,t,n,r){var a=e.getContext("2d");if(!a)throw new Error("no context");a.clearRect(0,0,e.width,e.height);var c,o=t.positions,i=Object(v.b)(t),s=e.getBoundingClientRect(),u=Math.min(s.height,s.width),l=function(e,t){var n,r=0,a=0,c=0,o=0,i=Object(m.a)(t.entries());try{for(i.s();!(n=i.n()).done;){var s,u=n.value,l=Object(m.a)(u[1]);try{for(l.s();!(s=l.n()).done;){var v=s.value;r=Math.min(v.p.x,r),a=Math.max(v.p.x,a),c=Math.min(v.p.y,c),o=Math.max(v.p.y,o)}}catch(w){l.e(w)}finally{l.f()}}}catch(w){i.e(w)}finally{i.f()}var j,p=new Map,h=Object(m.a)(t.entries());try{for(h.s();!(j=h.n()).done;){var b=Object(f.a)(j.value,2),O=b[0],y=b[1];p.set(O,y.map((function(t){return{p:Object(d.pos)(g(r,a,t.p.x,e),g(c,o,t.p.y,e)),tick:t.tick}})))}}catch(w){h.e(w)}finally{h.f()}return p}(u,o),j=t.rounds.filter((function(e,t){return r.has(t)})).map((function(e){return[e.startTick,e.endTick]})),p=O[t.tickRate]||.2,y=Object(m.a)(Object(v.a)(l,n,j).entries());try{for(y.s();!(c=y.n()).done;){var w=Object(f.a)(c.value,2),x=w[0],k=w[1];a.fillStyle=b(h(i,x),p);var N,T=Object(m.a)(k);try{for(T.s();!(N=T.n()).done;){var C=N.value;a.fillRect(C.p.x,u-C.p.y,2,2)}}catch(D){T.e(D)}finally{T.f()}}}catch(D){y.e(D)}finally{y.f()}}var w=n(9),x={tag:"window-resized"};function k(e){return{tag:"got-canvas-dimensions",r:e}}function N(){return Object(u.noCmd)({state:{tag:"fresh",dragOver:!1},error:u.nothing})}var T="csgo-canvas",C="canvas-wrapper",D=u.Task.fromLambda((function(){var e=document.getElementById(C);if(!e)throw new Error("canvas wrapper not found");var t=e.getBoundingClientRect();return Object(d.dim)(t.width,t.height)}));function E(e,t){return t.error.map((function(e){return Object(w.jsxs)("div",{className:"fragalyzer error",children:[Object(w.jsx)("h1",{children:"Oooops"}),Object(w.jsx)("pre",{children:e.message})]})})).withDefaultSupply((function(){var n=t.state;switch(n.tag){case"fresh":return Object(w.jsxs)("div",{className:"fragalyzer home",onDragOver:function(e){e.preventDefault()},children:[Object(w.jsx)("h1",{children:"CS:GO demo file analyzer"}),Object(w.jsxs)("p",{children:[Object(w.jsx)("code",{children:"fragalyzer"})," is a tool that analyzes a .dem file and draws the paths of players."]}),Object(w.jsx)("div",{className:"drop-zone".concat(n.dragOver?" drop-over":""),onDragOver:function(t){t.preventDefault(),e({tag:"drag-over",over:!0})},onDragLeave:function(){e({tag:"drag-over",over:!1})},onDropCapture:function(t){t.preventDefault();var n={tag:"file-dropped",file:u.nothing};if(1===t.dataTransfer.files.length){var r=t.dataTransfer.files.item(0);e(r?Object(s.a)(Object(s.a)({},n),{},{file:Object(u.just)(r)}):n)}else e(n)},children:"Drop a .dem here get started"})]});case"parsing":return Object(w.jsx)("div",{className:"fragalyzer parsing",children:Object(w.jsx)("p",{children:"Parsing demo file. It can take up to a few minutes..."})});case"ready":var r=n.parseResult,a=n.canvasDimensions;return Object(w.jsxs)("div",{className:"fragalyzer ready",children:[Object(w.jsxs)("div",{className:"main",children:[Object(w.jsx)("div",{id:C,className:"map-view",children:Object(w.jsx)("canvas",{height:a.h,width:a.w,id:T})}),Object(w.jsx)("div",{className:"right-panel",children:Object(v.d)(r).map((function(t){var a=Object(v.c)(r,t).map((function(e){return e.name})),c=Object(v.b)(r);return Object(w.jsxs)("div",{className:"team",children:[Object(w.jsx)("h2",{className:"team",children:t}),Object(w.jsx)("ul",{children:a.map((function(t){return Object(w.jsxs)("li",{children:[Object(w.jsx)("div",{className:"player-color",style:{backgroundColor:b(h(c,t),1)}}),Object(w.jsx)("input",{type:"checkbox",name:t,checked:n.selectedPlayers.has(t),onChange:function(n){return e({tag:"toggle-player",player:t})}}),t]},t)}))})]},t)}))})]}),F(e,r,n.selectedRounds)]})}}))}function R(e,t){switch(e.tag){case"window-resized":return z(t,(function(){return[t,u.Task.attempt(D,k)]}));case"drag-over":return"fresh"===t.state.tag?Object(u.noCmd)(Object(s.a)(Object(s.a)({},t),{},{state:{tag:"fresh",dragOver:!0}})):Object(u.noCmd)(t);case"got-canvas-dimensions":return e.r.match((function(e){return z(t,(function(n){var r=Object(s.a)(Object(s.a)({},t),{},{state:Object(s.a)(Object(s.a)({},n),{},{canvasDimensions:e})});return[r,S(r)]}))}),(function(e){return Object(u.noCmd)(Object(s.a)(Object(s.a)({},t),{},{error:Object(u.just)(e)}))}));case"file-dropped":return e.file.map((function(e){var n=Object(s.a)(Object(s.a)({},t),{},{state:{tag:"parsing"}}),r=u.Task.fromPromise((function(){return Object(v.e)(e)}));return[n,u.Task.attempt(r,(function(e){return{tag:"got-parse-result",r:e}}))]})).withDefaultSupply((function(){return Object(u.noCmd)(Object(s.a)(Object(s.a)({},t),{},{state:{tag:"fresh",dragOver:!1}}))}));case"got-parse-result":return e.r.match((function(e){var n=new Set(e.players.map((function(e){return e.name})));return[Object(s.a)(Object(s.a)({},t),{},{state:{tag:"ready",parseResult:e,selectedPlayers:n,canvasDimensions:d.Dim.zero,selectedRounds:new Set(e.rounds.map((function(e,t){return t})))}}),u.Task.attempt(D,k)]}),(function(e){return Object(u.noCmd)(Object(s.a)(Object(s.a)({},t),{},{error:Object(u.just)(e)}))}));case"got-draw-result":return console.log("draw res"),Object(u.noCmd)(t);case"toggle-player":return z(t,(function(n){var r=n.selectedPlayers,a=r.has(e.player)?Array.from(r).filter((function(t){return t!==e.player})):[].concat(Object(i.a)(Array.from(r)),[e.player]),c=P(t,Object(s.a)(Object(s.a)({},n),{},{selectedPlayers:new Set(a)}));return[c,S(c)]}));case"toggle-round":return z(t,(function(n){var r=n.selectedRounds,a=Array.from(r),c=new Set(r.has(e.index)?a.filter((function(t){return t!==e.index})):[].concat(Object(i.a)(a),[e.index])),o=P(t,Object(s.a)(Object(s.a)({},n),{},{selectedRounds:c}));return[o,S(o)]}))}}function z(e,t){return"ready"===e.state.tag?t(e.state):Object(u.noCmd)(e)}function P(e,t){return Object(s.a)(Object(s.a)({},e),{},{state:t})}function S(e){if("ready"===e.state.tag){var t=e.state,n=t.selectedPlayers;return function(e,t,n){var r=u.Task.fromLambda((function(){var r=document.getElementById(T);if(!r)throw new Error("canvas not found !");return y(r,e,t,n),e}));return u.Task.attempt(r,(function(e){return{tag:"got-draw-result",r:e}}))}(t.parseResult,n,t.selectedRounds)}return u.Cmd.none()}var M=new l.WindowEvents;function B(e){return M.on("resize",(function(){return x}))}function F(e,t,n){return Object(w.jsx)("div",{className:"timeline",children:t.rounds.map((function(t,r){var a=n.has(r),c="round".concat(a?" selected":"");return Object(w.jsx)("div",{className:c,onClick:function(){return e({tag:"toggle-round",index:r})},children:r+1},r)}))})}var _=function(){return Object(w.jsx)(l.Program,{init:N,view:E,update:R,subscriptions:B,devTools:l.DevTools.init(window)})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,765)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};o.a.render(Object(w.jsx)(a.a.StrictMode,{children:Object(w.jsx)(_,{})}),document.getElementById("root")),A()}},[[764,1,2]]]);
//# sourceMappingURL=main.b9a90a54.chunk.js.map