(this.webpackJsonpfragalyzer=this.webpackJsonpfragalyzer||[]).push([[0],{31:function(e,t,n){"use strict";(function(e){n.d(t,"e",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return l}));var r=n(37),a=n(645);function c(e){switch(e){case 1:return"Spectator";case 2:return"Terrorists";case 3:return"Counter Terrorists";default:return"Unknown-"+e}}function o(t){return new Promise((function(n,o){t.arrayBuffer().then((function(t){var s,i=e.from(t),u=new a.DemoFile,l=0,d=(new Date).getTime(),f=new Map,m=!1;u.on("tickend",(function(e){if(l++,m){var t=u.entities.players;t&&t.length>0&&t.forEach((function(t){if(t&&!t.isFakePlayer&&t.isAlive){var n=Object(r.pos)(t.position.x,t.position.y),a=f.get(t.name);void 0===a&&(a=[],f.set(t.name,a));var c={p:n,tick:e};a.push(c)}}))}}));var j=[],p=0;u.gameEvents.on("begin_new_match",(function(e){if(console.log("begin match"),void 0===s){m=!0,s=[];var t=u.players;s=t.filter((function(e){return!e.isFakePlayer&&e.teamNumber>=2})).map((function(e){var t=e.team;return{name:e.name,clanName:(null===t||void 0===t?void 0:t.clanName)||c(e.teamNumber)}})),console.log("players",s)}}));var v=0;u.gameEvents.on("round_start",(function(){console.log("round start"),v=u.currentTick})),u.gameEvents.on("round_end",(function(e){console.log("round end",e.winner),p=e.winner})),u.gameEvents.on("round_officially_ended",(function(e){console.log("round officially ended");var t=u.teams,n=t[2],r=t[3];console.log("\t%s: %s score %d\n\t%s: %s score %d",n.teamName,n.clanName,n.score,r.teamName,r.clanName,r.score),j.push({startTick:v,endTick:u.currentTick,winner:p,scoreCT:r.score,clanCT:r.clanName,scoreT:n.score,clanT:n.clanName})})),u.gameEvents.on("round_start",(function(e){p=0,console.log("round start",u.gameRules.roundsPlayed)})),u.on("end",(function(e){if(console.log("done, ticks =",l,"elapsed =",(new Date).getTime()-d),console.log("Finished."),e.error)console.error("Error during parsing:",e.error),o(e);else{var t={positions:f,players:s,rounds:j,tickRate:u.tickRate,mapName:u.header.mapName};console.log("parsed",t),n(t)}})),u.parse(i)}))}))}function s(e,t,n){var r=new Map;return e.forEach((function(e,a){t.has(a)&&r.set(a,e.filter((function(e){return void 0!==n.find((function(t){return e.tick>=t[0]&&e.tick<=t[1]}))})))})),r}function i(e){var t=new Set;return e.players.forEach((function(e){t.add(e.clanName)})),Array.from(t).sort()}function u(e,t){var n=new Array;return e.players.forEach((function(e){e.clanName===t&&n.push(e)})),n.sort((function(e,t){return e.name.localeCompare(t.name)}))}function l(e){return e.players.map((function(e){return e.name})).sort()}}).call(this,n(71).Buffer)},650:function(e,t,n){},651:function(e,t,n){},764:function(e,t,n){"use strict";n.r(t);var r=n(65),a=n.n(r),c=n(644),o=n.n(c),s=(n(650),n(132)),i=n(11),u=(n(651),n(10)),l=n(94),d=n(37),f=n(133),m=n(51),j=n(31);function p(e,t,n,r){return(n+-e)/((t-e)/r)}var v=[[0,140,255],[255,140,255],[255,0,255],[255,0,0],[255,132,97],[0,183,32],[238,183,32],[10,183,164],[198,197,0],[42,197,255],[221,91,90]],g=[0,0,0];function h(e,t){var n=e.indexOf(t);if(-1===n)return g;var r=v[n];return null!==r&&void 0!==r?r:g}function b(e,t){return"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(t,")")}var O={64:.2,128:.1};function y(e,t,n,r){var a=e.getContext("2d");if(!a)throw new Error("no context");a.clearRect(0,0,e.width,e.height);var c,o=t.positions,s=Object(j.b)(t),i=e.getBoundingClientRect(),u=Math.min(i.height,i.width),l=function(e,t){var n,r=0,a=0,c=0,o=0,s=Object(m.a)(t.entries());try{for(s.s();!(n=s.n()).done;){var i,u=n.value,l=Object(m.a)(u[1]);try{for(l.s();!(i=l.n()).done;){var j=i.value;r=Math.min(j.p.x,r),a=Math.max(j.p.x,a),c=Math.min(j.p.y,c),o=Math.max(j.p.y,o)}}catch(w){l.e(w)}finally{l.f()}}}catch(w){s.e(w)}finally{s.f()}var v,g=new Map,h=Object(m.a)(t.entries());try{for(h.s();!(v=h.n()).done;){var b=Object(f.a)(v.value,2),O=b[0],y=b[1];g.set(O,y.map((function(t){return{p:Object(d.pos)(p(r,a,t.p.x,e),p(c,o,t.p.y,e)),tick:t.tick}})))}}catch(w){h.e(w)}finally{h.f()}return g}(u,o),v=t.rounds.filter((function(e,t){return r.has(t)})).map((function(e){return[e.startTick,e.endTick]})),g=O[t.tickRate]||.2,y=Object(m.a)(Object(j.a)(l,n,v).entries());try{for(y.s();!(c=y.n()).done;){var w=Object(f.a)(c.value,2),x=w[0],k=w[1];a.fillStyle=b(h(s,x),g);var T,N=Object(m.a)(k);try{for(N.s();!(T=N.n()).done;){var C=T.value;a.fillRect(C.p.x,u-C.p.y,2,2)}}catch(D){N.e(D)}finally{N.f()}}}catch(D){y.e(D)}finally{y.f()}}var w=n(9),x={tag:"window-resized"};function k(e){return{tag:"got-canvas-dimensions",r:e}}function T(){return Object(u.noCmd)({state:{tag:"fresh",dragOver:!1},error:u.nothing})}var N="csgo-canvas",C="canvas-wrapper",D=u.Task.fromLambda((function(){var e=document.getElementById(C);if(!e)throw new Error("canvas wrapper not found");var t=e.getBoundingClientRect();return Object(d.dim)(t.width,t.height)}));function E(e,t){return t.error.map((function(e){return Object(w.jsxs)("div",{className:"fragalyzer error",children:[Object(w.jsx)("h1",{children:"Oooops"}),Object(w.jsx)("pre",{children:e.message})]})})).withDefaultSupply((function(){var n=t.state;switch(n.tag){case"fresh":return Object(w.jsxs)("div",{className:"fragalyzer home",onDragOver:function(e){e.preventDefault()},children:[Object(w.jsx)("h1",{children:"CS:GO demo file analyzer"}),Object(w.jsxs)("p",{children:[Object(w.jsx)("code",{children:"fragalyzer"})," is a tool that analyzes a .dem file and draws the paths of players."]}),Object(w.jsx)("div",{className:"drop-zone".concat(n.dragOver?" drop-over":""),onDragOver:function(t){t.preventDefault(),e({tag:"drag-over",over:!0})},onDragLeave:function(){e({tag:"drag-over",over:!1})},onDropCapture:function(t){t.preventDefault();var n={tag:"file-dropped",file:u.nothing};if(1===t.dataTransfer.files.length){var r=t.dataTransfer.files.item(0);e(r?Object(i.a)(Object(i.a)({},n),{},{file:Object(u.just)(r)}):n)}else e(n)},children:"Drop a .dem here get started"})]});case"parsing":return Object(w.jsx)("div",{className:"fragalyzer parsing",children:Object(w.jsx)("p",{children:"Parsing demo file. It can take up to a few minutes..."})});case"ready":var r=n.parseResult,a=n.canvasDimensions;return Object(w.jsxs)("div",{className:"fragalyzer ready",children:[Object(w.jsxs)("div",{className:"main",children:[Object(w.jsx)("div",{id:C,className:"map-view",children:Object(w.jsx)("canvas",{height:a.h,width:a.w,id:N})}),Object(w.jsxs)("div",{className:"right-panel",children:[Object(w.jsx)("h2",{children:"Map"}),Object(w.jsx)("p",{children:n.parseResult.mapName}),Object(j.d)(r).map((function(t){var a=Object(j.c)(r,t).map((function(e){return e.name})),c=Object(j.b)(r);return Object(w.jsxs)("div",{className:"team",children:[Object(w.jsx)("h2",{className:"team",children:t}),Object(w.jsx)("ul",{children:a.map((function(t){return Object(w.jsxs)("li",{children:[Object(w.jsx)("div",{className:"player-color",style:{backgroundColor:b(h(c,t),1)}}),Object(w.jsx)("input",{type:"checkbox",name:t,checked:n.selectedPlayers.has(t),onChange:function(n){return e({tag:"toggle-player",player:t})}}),t]},t)}))})]},t)}))]})]}),F(e,r,n.selectedRounds)]})}}))}function R(e,t){switch(e.tag){case"window-resized":return z(t,(function(){return[t,u.Task.attempt(D,k)]}));case"drag-over":return"fresh"===t.state.tag?Object(u.noCmd)(Object(i.a)(Object(i.a)({},t),{},{state:{tag:"fresh",dragOver:!0}})):Object(u.noCmd)(t);case"got-canvas-dimensions":return e.r.match((function(e){return z(t,(function(n){var r=Object(i.a)(Object(i.a)({},t),{},{state:Object(i.a)(Object(i.a)({},n),{},{canvasDimensions:e})});return[r,S(r)]}))}),(function(e){return Object(u.noCmd)(Object(i.a)(Object(i.a)({},t),{},{error:Object(u.just)(e)}))}));case"file-dropped":return e.file.map((function(e){var n=Object(i.a)(Object(i.a)({},t),{},{state:{tag:"parsing"}}),r=u.Task.fromPromise((function(){return Object(j.e)(e)}));return[n,u.Task.attempt(r,(function(e){return{tag:"got-parse-result",r:e}}))]})).withDefaultSupply((function(){return Object(u.noCmd)(Object(i.a)(Object(i.a)({},t),{},{state:{tag:"fresh",dragOver:!1}}))}));case"got-parse-result":return e.r.match((function(e){var n=new Set(e.players.map((function(e){return e.name})));return[Object(i.a)(Object(i.a)({},t),{},{state:{tag:"ready",parseResult:e,selectedPlayers:n,canvasDimensions:d.Dim.zero,selectedRounds:new Set(e.rounds.map((function(e,t){return t})))}}),u.Task.attempt(D,k)]}),(function(e){return Object(u.noCmd)(Object(i.a)(Object(i.a)({},t),{},{error:Object(u.just)(e)}))}));case"got-draw-result":return console.log("draw res"),Object(u.noCmd)(t);case"toggle-player":return z(t,(function(n){var r=n.selectedPlayers,a=r.has(e.player)?Array.from(r).filter((function(t){return t!==e.player})):[].concat(Object(s.a)(Array.from(r)),[e.player]),c=P(t,Object(i.a)(Object(i.a)({},n),{},{selectedPlayers:new Set(a)}));return[c,S(c)]}));case"toggle-round":return z(t,(function(n){var r=n.selectedRounds,a=Array.from(r),c=new Set(r.has(e.index)?a.filter((function(t){return t!==e.index})):[].concat(Object(s.a)(a),[e.index])),o=P(t,Object(i.a)(Object(i.a)({},n),{},{selectedRounds:c}));return[o,S(o)]}))}}function z(e,t){return"ready"===e.state.tag?t(e.state):Object(u.noCmd)(e)}function P(e,t){return Object(i.a)(Object(i.a)({},e),{},{state:t})}function S(e){if("ready"===e.state.tag){var t=e.state,n=t.selectedPlayers;return function(e,t,n){var r=u.Task.fromLambda((function(){var r=document.getElementById(N);if(!r)throw new Error("canvas not found !");return y(r,e,t,n),e}));return u.Task.attempt(r,(function(e){return{tag:"got-draw-result",r:e}}))}(t.parseResult,n,t.selectedRounds)}return u.Cmd.none()}var M=new l.WindowEvents;function B(e){return M.on("resize",(function(){return x}))}function F(e,t,n){return Object(w.jsx)("div",{className:"timeline",children:t.rounds.map((function(t,r){var a=n.has(r),c="round".concat(a?" selected":"");return Object(w.jsx)("div",{className:c,onClick:function(){return e({tag:"toggle-round",index:r})},children:r+1+" : "+t.scoreCT+"/"+t.scoreT},r)}))})}var _=function(){return Object(w.jsx)(l.Program,{init:T,view:E,update:R,subscriptions:B,devTools:l.DevTools.init(window)})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,765)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};o.a.render(Object(w.jsx)(a.a.StrictMode,{children:Object(w.jsx)(_,{})}),document.getElementById("root")),A()}},[[764,1,2]]]);
//# sourceMappingURL=main.d33c335a.chunk.js.map